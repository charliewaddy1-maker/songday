async function loadPlaylist(){
  const gameId = getQueryParam("game");
  if (!gameId) return document.getElementById("playlistContainer").innerHTML = "Missing game ID";

  const res = await fetch(`https://songday-api.YOURACCOUNT.workers.dev/playlist?game=${gameId}`);
  const data = await res.json();
  const container = document.getElementById("playlistContainer");

  if (!res.ok || !data.songs.length){
    container.innerHTML = "<p>No submissions yet.</p>";
    return;
  }

  let html = `<table><thead><tr><th>#</th><th>Title</th><th>Artist</th><th>Link</th><th>Player</th></tr></thead><tbody>`;
  data.songs.forEach((s,i) => {
    const link = s.link ? `<a href="${s.link}" target="_blank">play</a>` : "";
    html += `<tr><td>${i+1}</td><td>${s.title}</td><td>${s.artist}</td><td>${link}</td><td>${s.player}</td></tr>`;
  });
  html += `</tbody></table>`;
  container.innerHTML = html;

  // Download button
  document.getElementById("downloadPlaylist").onclick = () => {
    window.open(`https://songday-api.YOURACCOUNT.workers.dev/playlist-csv?game=${gameId}`, "_blank");
  };
}
loadPlaylist();
